<!DOCTYPE html>
<html lang="en">

<head>
    <title>Post-it</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="Css/style.css" rel="stylesheet">


</head>

<body>


    <div class="postBox" ondrop="drop(event)" ondragover="allowDrop(event)" id="postBox">
        <div id="postit_1" class="postit" draggable="true" ondragstart="drag(event)">
            test1
        </div>
        <div id="postit_2" class="postit" draggable="true" ondragstart="drag(event)">
            test2
        </div>
    </div>

    <script>
        window.onload = load();

        function load() {
            var postitString = localStorage.getItem("postitJDJ");

            var boxDiv = document.getElementById("postBox");
            console.log(boxDiv);

            if(postitString != null){
                var postitsO = JSON.parse(postitString);

                for (i = 0; i < postitsO.length; i++) {
                    var postitO = postitsO[i];
                    var postit = document.createElement("div");

                    postit.className = "postit";
                    postit.id = "postit_" + String(i+3);
                    postit.style.left = String(postitO.offsetx);
                    postit.style.top = String(postitO.offsety);
                    postit.style.width = String(postitO.width);
                    postit.style.height = String(postitO.height);

                    postit.addEventListener('dragstart', function() {drag(event)}, false);

                    boxDiv.appendChild(postit);
                }
            }
        }

        function save() {
            var postits = document.getElementsByClassName("postit");
            var postitsO = [];

            for (i = 0; i < postits.length; i++) {
                var postit = postits[i];

                var postitO = {
                    title : "title",
                    text : "test",
                    offsetx : postit.style.left,
                    offsety : postit.style.top,
                    width : postit.style.width,
                    height : postit.style.height
                }

                postitsO.push(postitO);
            }

            localStorage.setItem("postitJDJ",JSON.stringify(postitsO));
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("id", ev.target.id);
            ev.dataTransfer.setData("offsetx", ev.target.getBoundingClientRect().left - ev.clientX);
            ev.dataTransfer.setData("offsety", ev.target.getBoundingClientRect().top - ev.clientY);
        }

        function drop(ev) {
            ev.preventDefault();
            postit = document.getElementById(ev.dataTransfer.getData("id"));
            //ev.target.appendChild(postit);
            var left = (Number(ev.clientX) + Number(ev.dataTransfer.getData("offsetx")));
            var top = (Number(ev.clientY) + Number(ev.dataTransfer.getData("offsety")));

            if (left < 0) {
                left = 0;
            }

            if (top < 0) {
                top = 0;
            }

            postit.style.left = left.toString() + "px";
            postit.style.top = top.toString() + "px";
        }
    </script>
</body>

</html>
